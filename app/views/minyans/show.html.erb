<h1>Display Minyan</h1>

  <% if @minyan_event && @minyan_event.errors.any? %>
    <div id="error">
      <h2> <%= pluralize(@minyan_event.errors.count, "error") %> prohibited this post
           from being saved:</h2>
      <ul>
        <% @minyan_event.errors.full_messages.each do |e| %>
          <li> <%= e %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <p>
    <strong>Title:</strong>
    <%= @minyan.title %>
  </p>

  <p>
    <strong>Description:</strong>
    <%= @minyan.description %>
  </p>

  <p>
    <strong>Sunday:</strong>
    <%= @minyan.sun %>
  </p>

  <p>
    <strong>Monday:</strong>
    <%= @minyan.mon %>
  </p>

  <p>
    <strong>Tuesday:</strong>
    <%= @minyan.tue %>
  </p>

  <p>
    <strong>Wednesday:</strong>
    <%= @minyan.wed %>
  </p>

  <p>
    <strong>Thursday:</strong>
    <%= @minyan.thu %>
  </p>

  <p>
    <strong>Friday:</strong>
    <%= @minyan.fri %>
  </p>

  <p>
    <strong>Saturday:</strong>
    <%= @minyan.sat %>
  </p>

  <h2>Events</h2>
  <ul>
  <% @minyan.upcoming(10).each do |event| %>
    <li>
      <%= event.date %>
      <%= link_to "Delete Event",
                  [event.minyan, event],
                  method: :delete,
                  data: { confirm: "Are you sure?" } %>
      <%= link_to "Attend Event",
                  minyan_minyan_event_attend_path(event.minyan, event),
                  method: :post %>
      <!--
        Start adding new attendeed
        http://blog.brettjackson.org/post/55134095666/autocomplete-in-rails-with-typeahead-js
      -->
      <%= form_tag minyan_minyan_event_add_rsvp_path(event.minyan, event),
                method: :post, remote: :true do %>
        <!-- Set by the onSelected callback for the typeahead JS object below. -->
        <%= hidden_field_tag "yid_id" %>
        <input class='typeahead' type='text' id='yidTypeAhead' autocomplete='off'/>
          <!-- Need to work out how to move this out of being repeated for each item -->
          <script type='text/javascript'>
            $('.typeahead').typeahead([{
              name: 'yids',
              valueKey: 'name',
              remote: {url: '/yids/suggest/%QUERY.json'},
              template: formatYid
            }]).on('typeahead:selected', onSelected);
            function onSelected($e, datum) {
              console.log("Selected");
              console.log(datum);
              console.log (this.form.elements);
              var yidField = this.form.elements['yid_id'];
              console.log(datum.id);
              yidField.value = datum.id;
            }
            function formatYid(datum) {
              return datum.name + " | " + datum.email + " | " + datum.phone;
            }
          </script>

          <ul id="rsvp_list<%=event.id%>">
            <%= render event.rsvps %>
          </ul>
          <%= submit_tag %>
      <% end %> <!-- End for form -->
  <% end %>
  </ul>

  <h2>Add an event</h2>
  <%= form_for([@minyan, @minyan.minyan_events.build]) do |f| %>
    <%= f.label :date %>
    <%= f.date_field :date %>
    <p><%= f.submit %>
  <%end%>
<%= link_to "Back", minyans_path %> | <%= link_to "Edit", edit_minyan_path(@minyan) %>
